gitlabUrl: https://gitlab.local.iti.domain/
runnerRegistrationToken: "glrt-VXFR2qeKBZwMFvQ4Bsax"

runners:
  name: "k8s-runner"
  executor: "kubernetes"
  privileged: true
  config: |
    [[runners]]
      name = "k8s-runner"
      url = "https://gitlab.local.iti.domain/"
      executor = "kubernetes"
      [runners.kubernetes]
        image = "alpine:latest"
        privileged = true

# ÐœÐ¾Ð½Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚
volumes:
  - name: gitlab-ca-cert
    secret:
      secretName: gitlab-ca-cert
volumeMounts:
  - name: gitlab-ca-cert
    mountPath: /etc/gitlab-runner/certs
    readOnly: true

# âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ root-Ð¿Ñ€Ð°Ð²Ð°
securityContext:
  runAsUser: 0
  runAsGroup: 0
  fsGroup: 0
  runAsNonRoot: false

# ðŸ§° Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ initContainer Ð´Ð»Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ CA
initContainers:
  - name: install-ca-cert
    image: alpine:latest
    command:
      - /bin/sh
      - -c
      - |
        set -e
        cp /etc/gitlab-runner/certs/gitlab.local.iti.domain.crt /usr/local/share/ca-certificates/gitlab.local.iti.domain.crt
        update-ca-certificates 2>/dev/null || true
    volumeMounts:
      - name: gitlab-ca-cert
        mountPath: /etc/gitlab-runner/certs
